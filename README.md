# SignalRHubHtml

1. 先輸入編號跟用戶類型 user counselor(模擬登入會得到資料) 可以輸入Id:5

2. 點下ICON，如果有訊息會渲染出現
3. 按下連線，會連到伺服器的HUB
4. 點選即可聊天

連線重點
引用script
<!--Reference the SignalR library. -->
    <script src="https://pi.rocket-coding.com/Scripts/jquery.signalR-2.4.3.min.js"></script>
    <!--Reference the autoGenerated SignalR hub script. -->
    <script src="https://pi.rocket-coding.com/signalr/hubs"></script>

按下按鈕進入連線
 當連線成功的話 把自己登入的id 註冊到伺服器 (這裡手動輸入模擬登入會得到值)


        function hubConnect() {$.connection.hub.url = 'https://pi.rocket-coding.com/signalr';
            chat = $.connection.chartHubb;
               console.info(chat);  
               $.connection.hub.start().done(function () {
                var myNumber = document.getElementById("myNumber").value;
                var myType = document.getElementById("myType").value;
                chat.server.setUserId(myNumber , myType);
          
           });
             }; 
  
               

  
  

             
 //發送訊息按鈕
 
 //1.需要四個參數 沒有防呆...sned跟accept會存進去，後續讀取字串會有BUG
 
 //user 傳訊息給counselor, Type為send  
 
 //counselor 傳訊息給user , Type為accept
 
 //自己身分為user的話 範例如下
 
 axios.post('https://pi.rocket-coding.com/api/chatroom/chatlogs', data)
 
   const data = {
                        "CounselorId":outid,
                        "UserId": myNumberID,
                        "Type": send,
                        "Content": outmessage
                    };
                    
 //若為counselor 登陸的話
  
  const data = {
                        "CounselorId":myNumberID,
                        "UserId": outid,
                        "Type": accept,
                        "Content": outmessage
                    };
                    
  //訊息傳完會觸發 伺服器的method "sendto"
  
  //sendto 會呼叫自己跟對方網頁的function，總共三個 showMessage(int id ,msg , userType) showLastMsg() showIconUnRead()
  
  //showMessage(id , msg , userType) 會渲染聊天室訊息 EX
  
  //我的id為1的話 ,對方為2的話
  
  //我方網頁會執行 showMessage(1,hihi) 如果id=自己 就為我的訊息 -> if(myid == id) 1=1 ，我的訊息(id:1 hihi)
  
  //對方網頁會執行 showMessage(1,hihi) 如果id=自己 就為我的訊息 -> if(myid == id) 2=1 ，不等於所以是對方的訊息(id:1 hihi)
  
  
  //showLastMsg() 重新再打一次API取的值渲染網頁的聊天室列表(自己跟對方都會呼叫) 沒有參數 
  
  //showIconUnRead() 只會呼叫對方的function ，可以用來渲染ICON
  
  //總共三個api  
  
  //1. api/chatroom/chatlogs   儲存聊天內容
  
  //2. api/chatroom/GetChatlogs  取的聊天內容
  
  //3. api/chatroom/lastMsgTarget 取得有聊天過的人 與 最後一句話   UserRead 跟 CounselorRead 資料庫還沒更新，先藏起來用假數據，後續修改
  
DATA{
   x.ChatRoom.Id,
       CounselorId,
        UserId,
        Type,
        Content,
        InitDate,
        //UserRead,
        //CounselorRead
        }
